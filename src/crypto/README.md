# How private data is stored

## Goals

-   Store the master password, so it is possible to decrypt the transactions whatever derivation method is used.
-   Store the device secret key, so it is possible to synchronize the transactions.
-   Don't store the above secrets unencrypted, so if the computer/disk is stolen it is impossible to retrieve them.
-   Allow secret retrieval without use of OS password manager if the master password is known.

## Solution used

-   The OS password management system (Keychain for macOS, Credential Vault for Windows and libsecret for Linux) is used
    to store the randomly generated _local key_. It is then the responsibility of the OS password manager to encrypt
    this _local key_.
-   The secrets (master password and device secret key) are encrypted using the _local key_ and stored into the DB.
-   To be able to retrieve the _local key_ if the master password is known, it is encrypted using the master password
    and stored into the DB. Then, even without access to the OS password manager it is possible to retrieve all the
    secrets. If you don't want to use the OS password manager you can directly provide the master password via the
    environment variable `MP`.
-   To encrypt the local key using the master password a derivate has to be generated. However, at this point no
    derivation settings are known, so it is hard-coded via a fake transaction generated by
    `getDerivationParametersForLocalKey` in [keychainManager.ts](keychainManager.ts).
